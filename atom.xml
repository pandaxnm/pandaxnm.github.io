<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Charge Xiong</title>
  
  <subtitle>生命不息，折腾不止</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.mokeee.com/"/>
  <updated>2020-02-15T15:05:51.173Z</updated>
  <id>https://blog.mokeee.com/</id>
  
  <author>
    <name>chaojie.xiong</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>restful-yii2</title>
    <link href="https://blog.mokeee.com/2020/02/15/restful-yii2/"/>
    <id>https://blog.mokeee.com/2020/02/15/restful-yii2/</id>
    <published>2020-02-15T15:05:51.000Z</published>
    <updated>2020-02-15T15:05:51.173Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>MongoDB-Charts可视化图表分析工具安装使用</title>
    <link href="https://blog.mokeee.com/2020/01/06/mongdb-charts/"/>
    <id>https://blog.mokeee.com/2020/01/06/mongdb-charts/</id>
    <published>2020-01-06T13:42:13.000Z</published>
    <updated>2020-01-06T14:22:30.770Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.mongodb.com/products/charts">MongoDB-Charts</a>是创建MongoDB数据可视化的最佳方法。作为数据源连接到任何MongoDB实例，创建图表和图形，将它们嵌入到您的应用程序中，或构建实时仪表板以进行共享和协作。</p><a id="more"></a><p><a href="https://docs.mongodb.com/charts/master/">官方介绍文档</a></p><p><a href="https://docs.mongodb.com/charts/onprem/installation/">官方安装文档</a></p><p><img src="http://images.mokeee.com/sample-dashboard.png" alt=""></p><p><img src="http://images.mokeee.com/ArrayReductionChart-wnwfii0xsk.gif" alt=""></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h2><p>MongoDB： &gt;= 3.6<br>Docker： Docker CE或EE&gt;=v17.06</p><h2 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir mongodb-charts</span><br><span class="line"><span class="built_in">cd</span> mongodb-charts</span><br></pre></td></tr></table></figure><h2 id="下载Docker-Compose"><a href="#下载Docker-Compose" class="headerlink" title="下载Docker Compose"></a>下载Docker Compose</h2><p><a href="https://www.mongodb.com/download-center/charts">https://www.mongodb.com/download-center/charts</a></p><h2 id="启用Docker-Swarm模式"><a href="#启用Docker-Swarm模式" class="headerlink" title="启用Docker Swarm模式"></a>启用Docker Swarm模式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init</span><br></pre></td></tr></table></figure><h2 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull quay.io/mongodb/charts:19.12.1</span><br></pre></td></tr></table></figure><blockquote><p>版本号根据实际情况而定<br>下载可能需要一段时间。</p></blockquote><h2 id="测试连接"><a href="#测试连接" class="headerlink" title="测试连接"></a>测试连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm quay.io/mongodb/charts:v0.10.0 charts-cli <span class="built_in">test</span>-connection mongodb://&lt;username&gt;:&lt;password&gt;@yourhost/</span><br></pre></td></tr></table></figure><blockquote><p>注意：如果你需要连接本地的MongDB作为数据源，在填写host时不能使用<code>localhost</code></p></blockquote><ul><li>对于Docker 18.03及更高版本：</li><li>对于Windows和macOS，请使用mongodb://host.docker.internal。</li><li>对于Linux，请使用docker0接口的IP地址。通常，此地址为172.17.0.1。</li><li>对于Docker版本17.06至不包括18.03：</li><li>对于Windows，请使用mongodb://docker.for.win.localhost。</li><li>对于macOS，请使用mongodb://docker.for.mac.localhost。</li><li>对于Linux，请使用docker0接口的IP地址。通常，此地址为172.17.0.1。</li></ul><p>如果连接成功，将会显示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MongoDB connection URI successfully verified.</span><br></pre></td></tr></table></figure><h2 id="创建docker-secret"><a href="#创建docker-secret" class="headerlink" title="创建docker secret"></a>创建docker secret</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;Verified connection string URI from step 5&gt;"</span> | docker secret create charts-mongodb-uri -</span><br><span class="line">`</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"mongodb://admin:password@localhost:27017/"</span> | docker secret create charts-mongodb-uri -</span><br></pre></td></tr></table></figure><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c charts-docker-compose-v19.12.1.yml mongodb-charts</span><br></pre></td></tr></table></figure><h2 id="验证容器是否在运行"><a href="#验证容器是否在运行" class="headerlink" title="验证容器是否在运行"></a>验证容器是否在运行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service ls</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID             NAME                    MODE         REPLICAS   IMAGE                   PORTS</span><br><span class="line">j77uo3slyg4l   mongodb-charts_charts   replicated   1/1        mongodb-charts:latest   *:80-&gt;80/tcp</span><br></pre></td></tr></table></figure><h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><p>以Mac为例，将下面的<field>替换为自己的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it \</span><br><span class="line">  $(docker container ls --filter name=_charts -q) \</span><br><span class="line">  charts-cli add-user --first-name <span class="string">"&lt;First&gt;"</span> --last-name <span class="string">"&lt;Last&gt;"</span> \</span><br><span class="line">  --email <span class="string">"&lt;user@example.com&gt;"</span> --password <span class="string">"&lt;Password&gt;"</span> \</span><br><span class="line">  --role <span class="string">"&lt;UserAdmin|User&gt;"</span></span><br></pre></td></tr></table></figure><h2 id="启动和停止MongoDB图表"><a href="#启动和停止MongoDB图表" class="headerlink" title="启动和停止MongoDB图表"></a>启动和停止MongoDB图表</h2><p>启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c charts-docker-compose-v19.12.1.yml mongodb-charts</span><br></pre></td></tr></table></figure><p>停止：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack rm mongodb-charts</span><br></pre></td></tr></table></figure><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><p>输入<code>localhost:8180</code>进入MongoDB-Charts的WEB页面<br>使用刚才设置的用户名密码登录</p><h2 id="添加数据源"><a href="#添加数据源" class="headerlink" title="添加数据源"></a>添加数据源</h2><h2 id="添加图表"><a href="#添加图表" class="headerlink" title="添加图表"></a>添加图表</h2><h2 id="按需生成图表"><a href="#按需生成图表" class="headerlink" title="按需生成图表"></a>按需生成图表</h2>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://www.mongodb.com/products/charts&quot;&gt;MongoDB-Charts&lt;/a&gt;是创建MongoDB数据可视化的最佳方法。作为数据源连接到任何MongoDB实例，创建图表和图形，将它们嵌入到您的应用程序中，或构建实时仪表板以进行共享和协作。&lt;/p&gt;
    
    </summary>
    
      <category term="MongoDB" scheme="https://blog.mokeee.com/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="https://blog.mokeee.com/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>简单的接口加密</title>
    <link href="https://blog.mokeee.com/2020/01/05/api-simple-encrypt/"/>
    <id>https://blog.mokeee.com/2020/01/05/api-simple-encrypt/</id>
    <published>2020-01-05T14:21:22.000Z</published>
    <updated>2020-01-06T13:48:01.223Z</updated>
    
    <content type="html"><![CDATA[<p>在前后端的数据传输中，为了保证数据安全等原因，我们需要对传输的数据进行加密。</p><a id="more"></a><h1 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h1><p>客户端发送请求前加密，服务端接收到数据后解密<br>服务端返回数据前加密，客户端接收到数据后解密</p><h1 id="加密方式"><a href="#加密方式" class="headerlink" title="加密方式"></a>加密方式</h1><p>加密方式采用 <code>aes-128-cbc</code><br>客户端和服务端的<code>key</code>和<code>iv</code>要保持一致</p><h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><p>以<code>VUE</code>为例</p><ol><li>创建一个名为 <code>encrypt.js</code> 的文件，用于对数据加密解密  </li></ol><p>记得先安装扩展 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add crypto-js</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> CryptoJS <span class="keyword">from</span> <span class="string">'crypto-js/crypto-js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> key = CryptoJS.enc.Utf8.parse(<span class="string">"1234123412ABCDEF"</span>);</span><br><span class="line"><span class="keyword">const</span> iv = CryptoJS.enc.Utf8.parse(<span class="string">'ABCDEF1234123412'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//解密</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Decrypt</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> decryptedData = CryptoJS.AES.decrypt(data, key, &#123;</span><br><span class="line">        iv: iv,</span><br><span class="line">        mode: CryptoJS.mode.CBC,</span><br><span class="line">        padding: CryptoJS.pad.Pkcs7</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> decryptedStr = decryptedData.toString(CryptoJS.enc.Utf8);</span><br><span class="line">    <span class="keyword">return</span> decryptedStr.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//加密</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Encrypt</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> string = CryptoJS.enc.Utf8.parse(<span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">    <span class="keyword">let</span> encrypted = CryptoJS.AES.encrypt(string, key, &#123; <span class="attr">iv</span>: iv, <span class="attr">mode</span>: CryptoJS.mode.CBC, <span class="attr">padding</span>: CryptoJS.pad.Pkcs7 &#125;);</span><br><span class="line">    <span class="keyword">return</span> encrypted.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>创建HTTP请求文件 <code>http.js</code></li></ol><p>这里我们使用<code>axios</code>+<code>qs</code>，同样，记得安装扩展</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add axios</span><br><span class="line">yarn add qs</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Encrypt, Decrypt &#125; <span class="keyword">from</span> <span class="string">'./aes'</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'@/js_sdk/gangdiedao-uni-axios'</span></span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'qs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.create(&#123;</span><br><span class="line">    baseURL: <span class="string">'/api'</span>,</span><br><span class="line">    <span class="comment">// withCredentials: true,</span></span><br><span class="line">    timeout: <span class="number">10000</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送请求前对数据加密</span></span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">    config =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(config.method === <span class="string">'post'</span>)&#123;</span><br><span class="line">            <span class="keyword">let</span> encrypt = &#123;<span class="attr">encryptedData</span>: Encrypt(config.data)&#125;;</span><br><span class="line">            config.data = qs.stringify(encrypt)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> encrypt = &#123;<span class="attr">encryptedData</span>:Encrypt(config.params)&#125;;</span><br><span class="line">            config.params = encrypt;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> config</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//收到响应后解密数据</span></span><br><span class="line">service.interceptors.response.use(</span><br><span class="line"></span><br><span class="line">    response =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="built_in">JSON</span>.parse(Decrypt(response.data));</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url, data = &#123;&#125;,</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">        service.get(url, &#123;</span><br><span class="line">            params: data,</span><br><span class="line">        &#125;)</span><br><span class="line">            .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125;)</span><br><span class="line">            .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">                resolve(response);</span><br><span class="line">            &#125;,err =&gt; &#123;</span><br><span class="line">                reject(err)</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params">url,data = &#123;&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">        service.post(url, data)</span><br><span class="line">            .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125;)</span><br><span class="line">            .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">                resolve(response);</span><br><span class="line">            &#125;,err =&gt; &#123;</span><br><span class="line">                reject(err)</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，客户端发送的请求是这个样子：</p><p><code>https://example.com/api/user?encryptedData=LJGKLSDA34FJSLKDFJF</code></p><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><ol><li>定义加密解密方法</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> KEY = <span class="string">'1234123412ABCDEF'</span>;</span><br><span class="line"><span class="keyword">const</span> IV = <span class="string">'ABCDEF1234123412'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解密</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $data</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">decrypt</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    $cryptText = base64_decode($data);</span><br><span class="line">    $decrypted =  trim(openssl_decrypt($cryptText, <span class="string">'aes-128-cbc'</span>, <span class="keyword">self</span>::KEY, OPENSSL_RAW_DATA,<span class="keyword">self</span>::IV));</span><br><span class="line">    <span class="keyword">return</span> json_decode($decrypted, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 加密</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $data</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">encrypt</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    $cryptText = openssl_encrypt($data,<span class="string">"aes-128-cbc"</span>,<span class="keyword">self</span>::KEY,OPENSSL_RAW_DATA,<span class="keyword">self</span>::IV);</span><br><span class="line">    <span class="keyword">return</span> base64_encode($cryptText);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>使用</li></ol><p>解密</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$request = Yii::$app-&gt;getRequest();</span><br><span class="line"><span class="keyword">if</span>($method == <span class="string">'post'</span>)&#123;</span><br><span class="line">    $encryptedData = $request-&gt;post(<span class="string">'encryptedData'</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $encryptedData = $request-&gt;get(<span class="string">'encryptedData'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!$encryptedData) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br><span class="line">$decrypted = <span class="keyword">$this</span>-&gt;decrypt($encryptedData);</span><br></pre></td></tr></table></figure><p>加密</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$data = [</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'panda'</span>,</span><br><span class="line">    <span class="string">'age'</span> =&gt; <span class="number">18</span>,</span><br><span class="line">]</span><br><span class="line">$encrypted = <span class="keyword">$this</span>-&gt;encrypt(json_encode($data));</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在前后端的数据传输中，为了保证数据安全等原因，我们需要对传输的数据进行加密。&lt;/p&gt;
    
    </summary>
    
      <category term="Skills" scheme="https://blog.mokeee.com/categories/Skills/"/>
    
    
  </entry>
  
  <entry>
    <title>MongoDB使用</title>
    <link href="https://blog.mokeee.com/2019/12/06/mongodb-learning/"/>
    <id>https://blog.mokeee.com/2019/12/06/mongodb-learning/</id>
    <published>2019-12-06T13:05:01.000Z</published>
    <updated>2020-01-06T12:05:56.449Z</updated>
    
    <content type="html"><![CDATA[<p> MongoDB</p><a id="more"></a><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><ul><li>基于分布式文件存储的数据库。由C++语言编写。</li><li>介于关系数据库和非关系数据库之间，是非关系数据库当中功能最丰富，最像关系数据库的。它支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型。Mongo最大的特点是它支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。</li></ul><h1 id="数据形式"><a href="#数据形式" class="headerlink" title="数据形式"></a>数据形式</h1><p>MongoDB 存储的数据对象由键值对组成。MongoDB 所有存储在集合中的数据都是 BSON 格式。BSON 是一种类似 JSON 的二进制形式的存储格式，是 Binary JSON 的简称。</p><p>形式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span> : ObjectId(<span class="string">"5c89f787ca6e4e3ac1ecabkk"</span>),</span><br><span class="line">    <span class="string">"update_time"</span> : ISODate(<span class="string">"2019-06-03T15:00:42.142Z"</span>),</span><br><span class="line">    <span class="string">"create_time"</span> : ISODate(<span class="string">"2019-03-14T14:41:11.217Z"</span>),</span><br><span class="line">    <span class="string">"creator"</span> : <span class="string">"test_user"</span>,</span><br><span class="line">    <span class="string">"admin"</span> : [ </span><br><span class="line">        <span class="string">"admin1"</span>, </span><br><span class="line">        <span class="string">"admin2"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"ops"</span> : [ </span><br><span class="line">        <span class="string">"ops1"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"labels"</span> : &#123;</span><br><span class="line">        <span class="string">"department"</span> : <span class="string">"departmentA"</span>,</span><br><span class="line">        <span class="string">"main_class"</span> : <span class="string">"mainClassA"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="概念解析"><a href="#概念解析" class="headerlink" title="概念解析"></a>概念解析</h1><table><thead><tr><th>SQL术语/概念</th><th>MongoDB术语/概念</th><th>解释/说明</th></tr></thead><tbody><tr><td>database</td><td>database</td><td>数据库</td></tr><tr><td>table</td><td>collection</td><td>数据库表/集合</td></tr><tr><td>row</td><td>document</td><td>数据记录行/文档</td></tr><tr><td>column</td><td>field</td><td>数据字段/域</td></tr><tr><td>index</td><td>index</td><td>索引</td></tr><tr><td>primary key</td><td>primary key</td><td>主键,MongoDB自动将_id字段设置为主键</td></tr></tbody></table><h2 id="在MySql-中"><a href="#在MySql-中" class="headerlink" title="在MySql 中"></a>在MySql 中</h2><table><thead><tr><th>id</th><th>name</th><th>birthday</th><th>sex</th></tr></thead><tbody><tr><td>1</td><td>张豆豆</td><td>19960601</td><td>男</td></tr><tr><td>2</td><td>杨花花</td><td>19950726</td><td>女</td></tr></tbody></table><h2 id="在mongoDBzhong-中"><a href="#在mongoDBzhong-中" class="headerlink" title="在mongoDBzhong 中"></a>在mongoDBzhong 中</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span>: ObjectId(<span class="string">"5c89f787ca6e4e3ac1ehhb23"</span>), </span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"张豆豆"</span>,</span><br><span class="line">    <span class="string">"birthday"</span>: <span class="string">"19960601"</span>,</span><br><span class="line">    <span class="string">"sex"</span>: <span class="string">"男"</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span> : ObjectId(<span class="string">"5c89f787ca6e4e3ac1ehhb24"</span>),</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"杨花花"</span>,</span><br><span class="line">    <span class="string">"birthday"</span>: <span class="string">"19950726"</span>,</span><br><span class="line">    <span class="string">"sex"</span>: <span class="string">"女"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><hr><h1 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h1><h2 id="适用的场景"><a href="#适用的场景" class="headerlink" title="适用的场景"></a>适用的场景</h2><ul><li>无需要跨文档或跨表的事务及复杂的join查询支持 // 目前已经支持事务，join的支持也越来越好。</li><li>敏捷迭代的业务，需求变动频繁，数据模型无法确定</li><li>存储的数据格式灵活，不固定，或属于半结构化数据</li><li>业务并发访问量大，需数千的QPS(每秒查询率)</li><li>TB级以上的海量数据存储，且数据量不断增加</li><li>要求存储的数据持久化、不丢失</li><li>需要99.999%的数据高可用性</li></ul><p>场景举例：</p><ul><li>游戏场景：使用 MongoDB 存储游戏用户信息，用户的装备、积分等直接以内嵌文档的形式存储，方便查询、更新</li><li>物流场景：使用 MongoDB 存储订单信息，订单状态在运送过程中会不断更新，以 MongoDB 内嵌数组的形式来存储，一次查询就能将订单所有的变更读取出来。</li><li>社交场景：使用 MongoDB 存储存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实现附近的人、地点等功能</li><li>物联网场景：使用 MongoDB 存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些信息进行多维度的分析</li><li>视频直播：使用 MongoDB 存储用户信息、礼物信息等</li><li>……</li></ul><p>案例1</p><blockquote><p>用在应用服务器的日志记录，查找起来比文本灵活，导出也很方便。也是给应用练手，从外围系统开始使用MongoDB。<br>用在一些第三方信息的获取或者抓取，因为MongoDB的schema-less，所有格式灵活，不用为了各种格式不一样的信息专门设计统一的格式，极大的减少开发的工作。</p></blockquote><p>案例2</p><blockquote><p>mongodb之前有用过，主要用来存储一些监控数据，No schema 对开发人员来说，真的很方便，增加字段不用改表结构，而且学习成本极低。</p></blockquote><p>案例3</p><blockquote><p>使用MongoDB做了O2O快递应用，·将送快递骑手、快递商家的信息（包含位置信息）存储在 MongoDB，然后通过 MongoDB 的地理位置查询，这样很方便的实现了查找附近的商家、骑手等功能，使得快递骑手能就近接单，目前在使用MongoDB 上没遇到啥大的问题，官网的文档比较详细，很给力。</p></blockquote><h2 id="不适用的场景："><a href="#不适用的场景：" class="headerlink" title="不适用的场景："></a>不适用的场景：</h2><ul><li>要求<strong>高度事务性</strong>的系统。</li><li>复杂的<strong>跨表</strong>级联查询。</li></ul><hr><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="Homebrew安装"><a href="#Homebrew安装" class="headerlink" title="Homebrew安装"></a>Homebrew安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew tap mongodb/brew</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install mongodb-community@4.2</span><br></pre></td></tr></table></figure><p>环境变量：<br>打开 .bash_profile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open -e .bash_profile</span><br></pre></td></tr></table></figure><p>添加一行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/Cellar/mongodb-community/4.2.1/bin:<span class="variable">$&#123;PATH&#125;</span>&#125;</span><br></pre></td></tr></table></figure><p>然后</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source .bash_profile</span><br></pre></td></tr></table></figure><p>开机自启：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln  -sfv /usr/local/Cellar/mongodb-community/4.2.1/*.plist ~/Library/LaunchAgents</span><br></pre></td></tr></table></figure><h2 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h2><ol><li>下载</li></ol><p>下载地址： <a href="https://www.mongodb.com/download-center/community?jmp=nav">https://www.mongodb.com/download-center/community?jmp=nav</a></p><p>选择版本及对应的操作系统后进行下载<br><img src="http://images.mokeee.com/blog/20191124165455.jpg" alt=""></p><ol start="2"><li><p>将下载完成的文件解压并重命名为mongodb<br><img src="http://images.mokeee.com/blog/20191124163648.png" alt=""></p></li><li><p>将文件夹移动到 <code>/usr/local</code> 目录下<br><img src="http://images.mokeee.com/blog/20191124165909.png" alt=""></p></li><li><p>配置环境变量<br>在命令行中输入 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">open -e .bash_profile</span><br><span class="line">``` </span><br><span class="line">在打开的文件中添加一行</span><br><span class="line">``` bash</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;PATH&#125;</span>:/usr/<span class="built_in">local</span>/mongodb/bin</span><br></pre></td></tr></table></figure></li></ol><p>在命令行中输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> .bash_profile</span><br></pre></td></tr></table></figure><ol start="4"><li>创建mongodb数据存储目录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/db</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>启动服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod</span><br></pre></td></tr></table></figure><p>然后打开另一个命令行窗口，输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure><p>这样就可以操作mongodb了。</p><hr><h1 id="与PHP一起使用"><a href="#与PHP一起使用" class="headerlink" title="与PHP一起使用"></a>与PHP一起使用</h1><blockquote><p>在PHP中使用MongoDB，需要安装PHP-MongoDB驱动<br>我使用pecl安装</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pecl install mongodb</span><br></pre></td></tr></table></figure><h3 id="1-直接使用"><a href="#1-直接使用" class="headerlink" title="1. 直接使用"></a>1. 直接使用</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$manager = <span class="keyword">new</span> MongoDB\Driver\Manager(<span class="string">"mongodb://localhost:27017"</span>);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入数据</span></span><br><span class="line">$bulk = <span class="keyword">new</span> MongoDB\Driver\BulkWrite;</span><br><span class="line">$bulk-&gt;insert([<span class="string">'x'</span> =&gt; <span class="number">1</span>, <span class="string">'name'</span>=&gt;<span class="string">'baidu'</span>, <span class="string">'url'</span> =&gt; <span class="string">'http://www.baidu.com'</span>]);</span><br><span class="line">$bulk-&gt;insert([<span class="string">'x'</span> =&gt; <span class="number">2</span>, <span class="string">'name'</span>=&gt;<span class="string">'Google'</span>, <span class="string">'url'</span> =&gt; <span class="string">'http://www.google.com'</span>]);</span><br><span class="line">$bulk-&gt;insert([<span class="string">'x'</span> =&gt; <span class="number">3</span>, <span class="string">'name'</span>=&gt;<span class="string">'taobao'</span>, <span class="string">'url'</span> =&gt; <span class="string">'http://www.taobao.com'</span>]);</span><br><span class="line">$manager-&gt;executeBulkWrite(<span class="string">'test.sites'</span>, $bulk);</span><br><span class="line"></span><br><span class="line">$filter = [<span class="string">'x'</span> =&gt; [<span class="string">'$gt'</span> =&gt; <span class="number">1</span>]];</span><br><span class="line">$options = [</span><br><span class="line">    <span class="string">'projection'</span> =&gt; [<span class="string">'_id'</span> =&gt; <span class="number">0</span>],</span><br><span class="line">    <span class="string">'sort'</span> =&gt; [<span class="string">'x'</span> =&gt; <span class="number">-1</span>],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询数据</span></span><br><span class="line">$query = <span class="keyword">new</span> MongoDB\Driver\Query($filter, $options);</span><br><span class="line">$cursor = $manager-&gt;executeQuery(<span class="string">'test.sites'</span>, $query);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($cursor <span class="keyword">as</span> $document) &#123;</span><br><span class="line">    print_r($document);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-使用官方扩展包"><a href="#2-使用官方扩展包" class="headerlink" title="2. 使用官方扩展包"></a>2. 使用官方扩展包</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require mongodb/mongodb</span><br></pre></td></tr></table></figure><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//连接</span></span><br><span class="line">$client = <span class="keyword">new</span> MongoDB\Client(<span class="string">'mongodb://localhost:27017'</span>);</span><br><span class="line"><span class="comment">//选择数据库</span></span><br><span class="line">$db = $client-&gt;selectDatabase(<span class="string">"db"</span>);</span><br><span class="line"><span class="comment">//选择文档</span></span><br><span class="line">$collection  = $db-&gt;selectCollection(<span class="string">"collection"</span>);</span><br><span class="line"><span class="comment">//查询</span></span><br><span class="line">$result = $collection-&gt;findOne([<span class="string">'name'</span> =&gt; <span class="string">'panda'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><h3 id="3-在Yii中使用"><a href="#3-在Yii中使用" class="headerlink" title="3. 在Yii中使用"></a>3. 在Yii中使用</h3><blockquote><p>我平时用Yii比较多，所以记录一下在Yii中的使用方法。</p></blockquote><h4 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require yiisoft/yii2-mongodb</span><br></pre></td></tr></table></figure><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>在配置文件的 <code>components</code> 中加入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'mongodb'</span> =&gt; [</span><br><span class="line">         <span class="string">'class'</span> =&gt; <span class="string">'\yii\mongodb\Connection'</span>,</span><br><span class="line">         <span class="string">'dsn'</span> =&gt; <span class="string">'mongodb://localhost:27017/dbName'</span>,</span><br><span class="line">         <span class="string">'options'</span> =&gt; [</span><br><span class="line">              <span class="string">"username"</span> =&gt; <span class="string">"Username"</span>,</span><br><span class="line">              <span class="string">"password"</span> =&gt; <span class="string">"Password"</span></span><br><span class="line">         ]</span><br><span class="line">];</span><br></pre></td></tr></table></figure><h4 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h4><ol><li><p>组件使用</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = Yii::$app-&gt;mongodb-&gt;getCollection ( <span class="string">'user'</span> );</span><br><span class="line">$res = $collection-&gt;insert ( [</span><br><span class="line">      <span class="string">'name'</span> =&gt; <span class="string">'Panda'</span>,</span><br><span class="line">      <span class="string">'ag3'</span> =&gt; <span class="number">18</span></span><br><span class="line">] );</span><br></pre></td></tr></table></figure></li><li><p>model中使用<br>与MySQL类似，创建一个model文件，继承 <code>yii\mongodb\ActiveRecord</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">frontend</span>\<span class="title">models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Yii</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">yii</span>\<span class="title">db</span>\<span class="title">ActiveRecord</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This is the model class for table "vote_log".</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> int $id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> int $user_id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> int $post_id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> string $post_type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> int $created_at</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> int $updated_at</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> int $if_deleted</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VoteLog</span> <span class="keyword">extends</span> <span class="title">yii</span>\<span class="title">mongodb</span>\<span class="title">ActiveRecord</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义集合名称 注意是 collectionName，不是 tableName</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritdoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">collectionName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'vote_log'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义规则</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritdoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rules</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            [[<span class="string">'user_id'</span>, <span class="string">'post_id'</span>], <span class="string">'required'</span>],</span><br><span class="line">            [[<span class="string">'user_id'</span>, <span class="string">'post_id'</span>, <span class="string">'created_at'</span>, <span class="string">'updated_at'</span>, <span class="string">'if_deleted'</span>], <span class="string">'integer'</span>],</span><br><span class="line">            [[<span class="string">'user_id'</span>, <span class="string">'post_id'</span>,], <span class="string">'integer'</span>],</span><br><span class="line">            [[<span class="string">'post_type'</span>], <span class="string">'string'</span>, <span class="string">'max'</span> =&gt; <span class="number">20</span>],</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义字段 注意是 attributes，不是 attributeLabels</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritdoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">attributes</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="string">'_id'</span>, <span class="comment">//_id一定要有</span></span><br><span class="line">            <span class="string">'id'</span>,</span><br><span class="line">            <span class="string">'user_id'</span>,</span><br><span class="line">            <span class="string">'post_id'</span>,</span><br><span class="line">            <span class="string">'post_type'</span>,</span><br><span class="line">            <span class="string">'created_at'</span>,</span><br><span class="line">            <span class="string">'updated_at'</span>,</span><br><span class="line">            <span class="string">'if_deleted'</span>,</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找点赞记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $postId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $ifDeleted</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">findVoteLog</span><span class="params">($postId, $userId)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $voted = <span class="keyword">self</span>::findOne([<span class="string">'post_id'</span> =&gt; $postId, <span class="string">'user_id'</span> =&gt; $userId]);</span><br><span class="line">        <span class="keyword">return</span> $voted;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt; MongoDB&lt;/p&gt;
    
    </summary>
    
      <category term="MongoDB" scheme="https://blog.mokeee.com/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="https://blog.mokeee.com/tags/MongoDB/"/>
    
      <category term="数据库" scheme="https://blog.mokeee.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>Shell脚本学习笔记</title>
    <link href="https://blog.mokeee.com/2019/07/14/shell-script-leaning/"/>
    <id>https://blog.mokeee.com/2019/07/14/shell-script-leaning/</id>
    <published>2019-07-14T07:23:20.000Z</published>
    <updated>2019-07-22T13:52:23.383Z</updated>
    
    <content type="html"><![CDATA[<p>这是用来记录学习shell的文章。</p><a id="more"></a><blockquote><p>本文所写内容主要是根据网络教程和自我理解所得，如有错误之处，请指出。</p></blockquote><h1 id="解释器"><a href="#解释器" class="headerlink" title="解释器"></a>解释器</h1><p>一般shell脚本的第一行都是以 <code>#!/bin/sh</code> 开头，<code>#!</code> 标识用什么解释器来执行此脚本。</p><p>解释器的种类很多，比较常见的就是：</p><ul><li><code>/bin/sh</code></li><li><code>/bin/bash</code></li></ul><h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><p>在一行开头使用<code>#</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># author: 你的小可爱</span></span><br><span class="line"><span class="comment"># date: 2019-07-14</span></span><br></pre></td></tr></table></figure><p>shell中没有多行注释</p><h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><h2 id="命名规则"><a href="#命名规则" class="headerlink" title="命名规则"></a>命名规则</h2><ul><li>只能使用字母、数字、下划线，不能以数字开头</li><li>不能使用特殊符号</li><li>不能使用关键字</li></ul><p>变量名示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id</span><br><span class="line">USERNAME</span><br><span class="line">favorite</span><br><span class="line">favorite2</span><br><span class="line">_sex</span><br></pre></td></tr></table></figure><h2 id="使用变量"><a href="#使用变量" class="headerlink" title="使用变量"></a>使用变量</h2><h3 id="定义变量"><a href="#定义变量" class="headerlink" title="定义变量"></a>定义变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">"你的小可爱"</span></span><br></pre></td></tr></table></figure><p>注意点：</p><ol><li>定义变量时，变量名不需要使用<code>$</code>符号</li><li>等号前后不能有空格</li></ol><h3 id="使用变量-1"><a href="#使用变量-1" class="headerlink" title="使用变量"></a>使用变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;name&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"我的名字是：<span class="variable">$&#123;name&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">name=<span class="string">"大家的小可爱"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$name</span></span><br></pre></td></tr></table></figure><p>注意点：</p><ol><li>定义变量时变量名前不需要加<code>$</code>，但使用时需要加<code>$</code>。</li><li>重新定义变量时，变量名前不需要加<code>$</code>,只在使用变量时才加。</li></ol><h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><h2 id="单双引号"><a href="#单双引号" class="headerlink" title="单双引号"></a>单双引号</h2><p>在shell中字符串可以使用单引号、双引号，也可以不使用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str=<span class="string">'Hello World.'</span></span><br><span class="line">str2=<span class="string">"你好世界"</span></span><br><span class="line">str3=泥豪啊</span><br></pre></td></tr></table></figure><p>注意点：</p><ol><li>单引号中的内容会原样输出，单引号中的变量无效</li><li>单引号字串中不能出现单独一个的单引号（对单引号使用转义符后也不行）</li><li>双引号中可以使用变量和转义字符</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">age=18;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'my age is $&#123;age&#125;'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"my age is <span class="variable">$&#123;age&#125;</span> \nHow old are you?"</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my age is $&#123;age&#125;</span><br><span class="line">my age is 18</span><br><span class="line">How old are you?</span><br></pre></td></tr></table></figure><h2 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h2><h3 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">"你的小可爱"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"你好，我是<span class="variable">$&#123;name&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"你好，我是"</span><span class="variable">$name</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"你好，我是"</span><span class="variable">$name</span><span class="string">"，哈哈"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'你好，我是'</span><span class="variable">$name</span><span class="string">'，哈哈'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># 你好，我是你的小可爱</span></span><br><span class="line"><span class="comment"># 你好，我是你的小可爱</span></span><br><span class="line"><span class="comment"># 你好，我是你的小可爱，哈哈</span></span><br><span class="line"><span class="comment"># 你好，我是你的小可爱，哈哈</span></span><br></pre></td></tr></table></figure><h3 id="字符串长度"><a href="#字符串长度" class="headerlink" title="字符串长度"></a>字符串长度</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str=<span class="string">"hello"</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#str&#125;</span>;</span><br><span class="line"><span class="comment">#输出：5</span></span><br></pre></td></tr></table></figure><h3 id="字符串截取"><a href="#字符串截取" class="headerlink" title="字符串截取"></a>字符串截取</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">str=<span class="string">"abcdefg"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;str:1:3&#125;</span> </span><br><span class="line"><span class="comment"># 输出 bcd</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;str:0:4&#125;</span></span><br><span class="line"><span class="comment"># 输出 abcd</span></span><br></pre></td></tr></table></figure><h1 id="用户输入"><a href="#用户输入" class="headerlink" title="用户输入"></a>用户输入</h1><h2 id="执行脚本时传入"><a href="#执行脚本时传入" class="headerlink" title="执行脚本时传入"></a>执行脚本时传入</h2><ol><li>在执行脚本时可向脚本传入参数，参数之间用空格隔开，在脚本内使用<code>$n</code>来接收参数，n代表是第几个参数，如<code>$1</code>代表第一个参数。</li><li>如果参数内有空格，可以使用引号将参数括起来。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"执行的文件名：<span class="variable">$0</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第一个参数为：<span class="variable">$1</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第二个参数为：<span class="variable">$2</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第二个参数为：<span class="variable">$3</span>"</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜ ./test.sh 1 &apos;2 22&apos; &quot;3 33&quot;</span><br><span class="line">第一个参数为：1</span><br><span class="line">第二个参数为：2 22</span><br><span class="line">第二个参数为：3 33</span><br></pre></td></tr></table></figure><p>获取传入参数的个数，使用<code>$#</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"传入参数个数："</span><span class="variable">$#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"传入参数个数：<span class="variable">$&#123;#&#125;</span>"</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ ./test.sh 1 &apos;2 22&apos; &quot;3 33&quot;</span><br><span class="line">传入参数个数：3</span><br><span class="line">传入参数个数：3</span><br></pre></td></tr></table></figure><h2 id="运行脚本时输入"><a href="#运行脚本时输入" class="headerlink" title="运行脚本时输入"></a>运行脚本时输入</h2><p>使用<code>read</code>在程序运行时获取用户输入的参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"Please enter your name:"</span></span><br><span class="line"><span class="built_in">read</span> name</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Hello <span class="variable">$name</span>"</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜ ./test.sh</span><br><span class="line">Please enter your name:</span><br><span class="line">熊小帅</span><br><span class="line">Hello 熊小帅</span><br></pre></td></tr></table></figure><p>使用<code>-p</code>直接指定一个提示语句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> -p <span class="string">"Please enter your name:"</span> name</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Hello <span class="variable">$name</span>"</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ ./test.sh</span><br><span class="line">Please enter your name:熊大帅</span><br><span class="line">Hello 熊大帅</span><br></pre></td></tr></table></figure><p>使用<code>-t</code>进行倒计时，用户需要在指定时间(秒)内完成输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">read</span> -t 5 -p <span class="string">"Please enter your name in 5 seconds:"</span> name</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Hello <span class="variable">$name</span>"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"timeout"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ ./test.sh</span><br><span class="line">Please enter your name in 5 seconds:</span><br><span class="line">timeout</span><br></pre></td></tr></table></figure><p>使用<code>-s</code>隐藏输入内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> -s -p <span class="string">"Please enter your password:"</span> <span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"I got it! Your password is: <span class="variable">$pwd</span>"</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ ./test.sh</span><br><span class="line">Please enter your password:</span><br><span class="line">I got it! Your password is: 123456</span><br></pre></td></tr></table></figure><h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><p>shell中的运算符包括：</p><ul><li>算数运算符</li><li>关系运算符</li><li>布尔运算符</li><li>字符串运算符</li><li>文件测试运算符</li></ul><p>在Linux的shell中，变量的值的类型默认是字符串，不能直接进行数值运算。<br>但是可以通过其他命令来实现，如expr。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> `expr 1 + 2`</span><br><span class="line"><span class="comment"># 输出：3</span></span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>表达式需要用反引号<code>``</code>括起来</li><li>表达式和运算符之间要用空格隔开，如<code>1 + 2</code>不能写成<code>1+2</code>，<code>=</code> 赋值时，前后无空格</li></ol><h2 id="算数运算符"><a href="#算数运算符" class="headerlink" title="算数运算符"></a>算数运算符</h2><table><thead><tr><th align="center">运算符</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">+</td><td align="center">加</td></tr><tr><td align="center">-</td><td align="center">减</td></tr><tr><td align="center">*</td><td align="center">乘</td></tr><tr><td align="center">/</td><td align="center">除</td></tr><tr><td align="center">%</td><td align="center">取余</td></tr><tr><td align="center">=</td><td align="center">赋值</td></tr><tr><td align="center">==</td><td align="center">相等</td></tr><tr><td align="center">!=</td><td align="center">不等</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=1</span><br><span class="line">b=2</span><br><span class="line"><span class="built_in">echo</span> `expr <span class="variable">$a</span> + <span class="variable">$b</span>`</span><br><span class="line"><span class="built_in">echo</span> `expr <span class="variable">$a</span> - <span class="variable">$b</span>`</span><br><span class="line"><span class="built_in">echo</span> `expr <span class="variable">$a</span> \* <span class="variable">$b</span>`</span><br><span class="line"><span class="built_in">echo</span> `expr <span class="variable">$b</span> / <span class="variable">$a</span>`</span><br><span class="line"><span class="built_in">echo</span> `expr <span class="variable">$b</span> % <span class="variable">$a</span>`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> == <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a等于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span>  [ <span class="variable">$a</span> != <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a不等于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">-1</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">0</span><br><span class="line">a不等于b</span><br></pre></td></tr></table></figure><p>注意：</p><ol><li><code>[]</code>代表一个表达式，<code>[]</code>中的内容要与两侧的符号使用空格隔开，<br>如<code>[ $a + $b ]</code>，不能写成<code>[$a+$b]</code></li><li>乘号<code>*</code>前边必须加反斜杠<code>\</code></li><li>在MAC上，expr语法可以写成 <code>$((表达式))</code>，亲测表达式和运算符之间可以不加空格，<br><code>$(($a+$b))</code>和<code>$(($a + $b))</code>都可以；乘法写成<code>$(($a*$b))</code>，不需要加<code>\</code></li></ol><p>MAC shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=1</span><br><span class="line">b=2</span><br><span class="line"><span class="built_in">echo</span> $((<span class="variable">$a</span> + <span class="variable">$b</span>))</span><br><span class="line"><span class="built_in">echo</span> $((<span class="variable">$a</span>-<span class="variable">$b</span>))</span><br><span class="line"><span class="built_in">echo</span> $((<span class="variable">$a</span>*<span class="variable">$b</span>))</span><br><span class="line"><span class="built_in">echo</span> $((<span class="variable">$b</span>/<span class="variable">$a</span>))</span><br><span class="line"><span class="built_in">echo</span> $((<span class="variable">$b</span>%<span class="variable">$a</span>))</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> == <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a等于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span>  [ <span class="variable">$a</span> != <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a不等于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">-1</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">0</span><br><span class="line">a不等于b</span><br></pre></td></tr></table></figure><h2 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h2><table><thead><tr><th align="center">运算符</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">-eq</td><td align="center">相等</td></tr><tr><td align="center">-ne</td><td align="center">不等</td></tr><tr><td align="center">-gt</td><td align="center">大于</td></tr><tr><td align="center">-lt</td><td align="center">小于</td></tr><tr><td align="center">-ge</td><td align="center">大于等于</td></tr><tr><td align="center">-le</td><td align="center">小于等于</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=1</span><br><span class="line">b=2</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -eq <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a等于b"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a不等于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -ne <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a不等于b"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a等于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -gt <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a大于b"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a不大于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -lt <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a小于b"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a不小于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -ge <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a大于等于b"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a小于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -le <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a小于等于b"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a大于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">a不等于b</span><br><span class="line">a不等于b</span><br><span class="line">a不大于b</span><br><span class="line">a小于b</span><br><span class="line">a小于b</span><br><span class="line">a小于等于b</span><br></pre></td></tr></table></figure><h2 id="布尔运算符"><a href="#布尔运算符" class="headerlink" title="布尔运算符"></a>布尔运算符</h2><table><thead><tr><th align="center">运算符</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">!</td><td align="center">非</td></tr><tr><td align="center">-o</td><td align="center">或</td></tr><tr><td align="center">-a</td><td align="center">与</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=1</span><br><span class="line">b=20</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> != <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a不等于b"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a等于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -gt 2 -o <span class="variable">$b</span> -gt 10 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a大于2或b大于10"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a小于等于2并且b小于等于10"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -gt 2 -a <span class="variable">$b</span> -gt 10 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a大于2并且b大于10"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a小于等于2或者b小于等于10"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">a不等于b</span><br><span class="line">a大于2或b大于10</span><br><span class="line">a小于等于2或者b小于等于10</span><br></pre></td></tr></table></figure><h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><table><thead><tr><th align="center">运算符</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">&amp;&amp;</td><td align="center">逻辑and</td></tr><tr><td align="center">||</td><td align="center">逻辑or</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=1</span><br><span class="line">b=20</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$a</span> -lt 2 &amp;&amp; <span class="variable">$b</span> -gt 10 ]]</span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a小于2并且b大于10"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a大于等于2或者b小于等于10"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$a</span> -lt 2 || <span class="variable">$b</span> -gt 10 ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a小于2或者b大于10"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a大于等于2并且b小于等于10"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">a小于2并且b大于10</span><br><span class="line">a小于2或者b大于10</span><br></pre></td></tr></table></figure><blockquote><p><code>[[  ]]</code> 是什么？</p></blockquote><h2 id="字符串运算符"><a href="#字符串运算符" class="headerlink" title="字符串运算符"></a>字符串运算符</h2><table><thead><tr><th align="center">运算符</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">=</td><td align="center">检测两个字符串是否相等</td></tr><tr><td align="center">!=</td><td align="center">检测两个字符串是否相等</td></tr><tr><td align="center">-z</td><td align="center">检测字符串长度是否为0</td></tr><tr><td align="center">-n</td><td align="center">检测字符串长度是否不为0</td></tr><tr><td align="center">$</td><td align="center">检测字符串是否不为空</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=<span class="string">"abc"</span></span><br><span class="line">b=<span class="string">"def"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> = <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a等于b"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a不等于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> != <span class="variable">$b</span>]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a不等于b"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a等于b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$a</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a的长度为0"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a的长度不为0"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="variable">$a</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a的长度不为0"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a的长度为0"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a不为空"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"a为空"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">a不等于b</span><br><span class="line">a不等于b</span><br><span class="line">a的长度不为0</span><br><span class="line">a的长度不为0</span><br><span class="line">a不为空</span><br></pre></td></tr></table></figure><h2 id="文件测试运算符"><a href="#文件测试运算符" class="headerlink" title="文件测试运算符"></a>文件测试运算符</h2><table><thead><tr><th align="center">运算符</th><th align="left">说明</th><th align="center">举例</th></tr></thead><tbody><tr><td align="center">-b file</td><td align="left">检测文件是否是块设备文件，如果是，则返回 true。</td><td align="center">[ -b $file ] 返回 false。</td></tr><tr><td align="center">-c file</td><td align="left">检测文件是否是字符设备文件，如果是，则返回 true。</td><td align="center">[ -c $file ] 返回 false。</td></tr><tr><td align="center">-d file</td><td align="left">检测文件是否是目录，如果是，则返回 true。</td><td align="center">[ -d $file ] 返回 false。</td></tr><tr><td align="center">-f file</td><td align="left">检测文件是否是普通文件（既不是目录，也不是设备文件），如果是，则返回 true。</td><td align="center">[ -f $file ] 返回 true。</td></tr><tr><td align="center">-g file</td><td align="left">检测文件是否设置了 SGID 位，如果是，则返回 true。</td><td align="center">[ -g $file ] 返回 false。</td></tr><tr><td align="center">-k file</td><td align="left">检测文件是否设置了粘着位(Sticky Bit)，如果是，则返回 true。</td><td align="center">[ -k $file ] 返回 false。</td></tr><tr><td align="center">-p file</td><td align="left">检测文件是否是有名管道，如果是，则返回 true。</td><td align="center">[ -p $file ] 返回 false。</td></tr><tr><td align="center">-u file</td><td align="left">检测文件是否设置了 SUID 位，如果是，则返回 true。</td><td align="center">[ -u $file ] 返回 false。</td></tr><tr><td align="center">-r file</td><td align="left">检测文件是否可读，如果是，则返回 true。</td><td align="center">[ -r $file ] 返回 true。</td></tr><tr><td align="center">-w file</td><td align="left">检测文件是否可写，如果是，则返回 true。</td><td align="center">[ -w $file ] 返回 true。</td></tr><tr><td align="center">-x file</td><td align="left">检测文件是否可执行，如果是，则返回 true。</td><td align="center">[ -x $file ] 返回 true。</td></tr><tr><td align="center">-s file</td><td align="left">检测文件是否为空（文件大小是否大于0），不为空返回 true。</td><td align="center">[ -s $file ] 返回 true。</td></tr><tr><td align="center">-e file</td><td align="left">检测文件（包括目录）是否存在，如果是，则返回 true。</td><td align="center">[ -e $file ] 返回 true。</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">file=<span class="string">"/var/www/runoob/test.sh"</span></span><br><span class="line"><span class="keyword">if</span> [ -r <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件可读"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件不可读"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -w <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件可写"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件不可写"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -x <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件可执行"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件不可执行"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件为普通文件"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件为特殊文件"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件是个目录"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件不是个目录"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -s <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件不为空"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件为空"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -e <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件存在"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"文件不存在"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">文件可读</span><br><span class="line">文件可写</span><br><span class="line">文件可执行</span><br><span class="line">文件为普通文件</span><br><span class="line">文件不是个目录</span><br><span class="line">文件不为空</span><br><span class="line">文件存在</span><br></pre></td></tr></table></figure><h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><p>与大多数编程语言一样，数组下标从0开始，且Bash Shell只支持一维数组。<br>Shell 数组用括号来表示，元素用<code>空格</code>分开.</p><h2 id="定义数组"><a href="#定义数组" class="headerlink" title="定义数组"></a>定义数组</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array=(A B C <span class="string">"D"</span>)</span><br></pre></td></tr></table></figure><p>也可使使用下标来定义数组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">array[0]=A</span><br><span class="line">array[1]=B</span><br><span class="line">array[2]=C</span><br><span class="line">array[3]=<span class="string">"D"</span></span><br></pre></td></tr></table></figure><h2 id="读取数组"><a href="#读取数组" class="headerlink" title="读取数组"></a>读取数组</h2><p>读取数组的格式为： <code>${array[index]}</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">array=(A B C <span class="string">"D"</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第一个元素：<span class="variable">$&#123;array[0]&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第二个元素：<span class="variable">$&#123;array[1]&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第三个元素：<span class="variable">$&#123;array[2]&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第四个元素：<span class="variable">$&#123;array[3]&#125;</span>"</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">第一个元素：A</span><br><span class="line">第二个元素：B</span><br><span class="line">第三个元素：C</span><br><span class="line">第四个元素：D</span><br></pre></td></tr></table></figure><h2 id="获取数组中的所有元素"><a href="#获取数组中的所有元素" class="headerlink" title="获取数组中的所有元素"></a>获取数组中的所有元素</h2><p>使用<code>@</code>或者<code>*</code>来获取数组中的所有元素</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">array=(A B C D)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"数组中的所有元素<span class="variable">$&#123;array[*]&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"数组中的所有元素<span class="variable">$&#123;array[@]&#125;</span>"</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">数组中的所有元素A B C D</span><br><span class="line">数组中的所有元素A B C D</span><br></pre></td></tr></table></figure><h2 id="获取数组的长度"><a href="#获取数组的长度" class="headerlink" title="获取数组的长度"></a>获取数组的长度</h2><p>获取数组长度的方法与字符串类似。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">array=(A B C D)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"数组元素个数<span class="variable">$&#123;#array[*]&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"数组元素个数<span class="variable">$&#123;#array[@]&#125;</span>"</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">数组元素个数4</span><br><span class="line">数组元素个数4</span><br></pre></td></tr></table></figure><h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><p>格式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 条件</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    执行语句</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="if-else"><a href="#if-else" class="headerlink" title="if else"></a>if else</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 条件</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    执行语句</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    执行语句2</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="if-else-if-else"><a href="#if-else-if-else" class="headerlink" title="if else-if else"></a>if else-if else</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 条件</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    执行语句</span><br><span class="line"><span class="keyword">elif</span> 条件2</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    执行语句2</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    执行语句3</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="for"><a href="#for" class="headerlink" title="for"></a>for</h2><p>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> items</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    执行命令</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> 1 2 3 4</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$item</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">arr=(1 2 3 4)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable">$&#123;arr[*]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$item</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>以上两个都会输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td></tr></table></figure><h2 id="while"><a href="#while" class="headerlink" title="while"></a>while</h2><p>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> 条件</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    执行命令</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$a</span> -lt 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line">    a=`expr <span class="variable">$a</span> + 1`</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td></tr></table></figure><p>while循环可用于读取键盘信息：<br>只有当用户按下 <code>ctrl+D</code> 时程序才会退出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"请输入你的名字： （按 ctrl+d 退出）"</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> input</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"hello <span class="variable">$&#123;input&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">请输入你的名字： （按 ctrl+d 退出）</span><br><span class="line">吴彦祖</span><br><span class="line">hello 吴彦祖</span><br><span class="line">古天乐</span><br><span class="line">hello 古天乐</span><br></pre></td></tr></table></figure><h2 id="until"><a href="#until" class="headerlink" title="until"></a>until</h2><p>until与while相反，当条件成立时退出<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">until 条件</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    执行命令</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=0</span><br><span class="line">until [ <span class="variable">$a</span> -gt 10 ] </span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line">    a=`expr <span class="variable">$a</span> + 1`</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td></tr></table></figure><h2 id="case"><a href="#case" class="headerlink" title="case"></a>case</h2><p>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> 值 <span class="keyword">in</span></span><br><span class="line">值1)</span><br><span class="line">    命令1</span><br><span class="line">    ;;</span><br><span class="line">值2)</span><br><span class="line">    命令2</span><br><span class="line">    ;;</span><br><span class="line">*) </span><br><span class="line">    其他值</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"请输入1-3之间的数字："</span> num</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$num</span> <span class="keyword">in</span></span><br><span class="line">    1) </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"你输入的是1"</span></span><br><span class="line">    ;;</span><br><span class="line">    2) </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"你输入的是2"</span></span><br><span class="line">    ;;</span><br><span class="line">    3) </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"你输入的是3"</span></span><br><span class="line">    ;;</span><br><span class="line">    *) </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"你没有输入1-3之间的数字"</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">请输入1-3之间的数字：1</span><br><span class="line">你输入的是1</span><br></pre></td></tr></table></figure><h2 id="跳出循环"><a href="#跳出循环" class="headerlink" title="跳出循环"></a>跳出循环</h2><p>与PHP语法类似<br><code>continue</code> 跳过本次循环<br><code>break</code> 跳出所有循环</p><h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h2><p>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">testFun</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"11111"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">testFun</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11111</span><br></pre></td></tr></table></figure><blockquote><p>所有函数在使用前必须定义</p></blockquote><h2 id="函数返回值"><a href="#函数返回值" class="headerlink" title="函数返回值"></a>函数返回值</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">readFun</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"演示两个数字相加"</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">"请输入第一个数字："</span> first</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">"请输入第二个数字："</span> second</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> `expr <span class="variable">$first</span> + <span class="variable">$second</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">readFun</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"两数之和为$?"</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">演示两个数字相加</span><br><span class="line">请输入第一个数字：1</span><br><span class="line">请输入第二个数字：2</span><br><span class="line">两数之和为3</span><br></pre></td></tr></table></figure><blockquote><p>函数返回值在调用该函数后通过 <code>$?</code> 来获得</p></blockquote><h2 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">paramFun</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"第一个参数：<span class="variable">$&#123;1&#125;</span>"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"第二个参数：<span class="variable">$2</span>"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"第三个参数：<span class="variable">$3</span>"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"一共有<span class="variable">$&#123;#&#125;</span>个参数"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"输出所有参数：<span class="variable">$@</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">paramFun 1 2 3 4</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">第一个参数：1</span><br><span class="line">第二个参数：2</span><br><span class="line">第三个参数：3</span><br><span class="line">一共有4个参数</span><br><span class="line">输出所有参数：1 2 3 4</span><br></pre></td></tr></table></figure><ol><li>与执行脚本时传入参数类似，调用函数时传入参数用空格隔开，在函数内部通过<code>$n</code>的形式来获取传入参数</li><li>需要注意的是，当获取第n&gt;=10个参数时，需要通过<code>${n}</code>的形式来获取，当然小于10的时候也是能通过<code>${n}</code>的形式来获取参数</li></ol><h1 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h1><p>默认 printf 不会像 echo 自动添加换行符，我们可以手动添加 \n。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"hello"</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">"hello\n"</span></span><br></pre></td></tr></table></figure><p>与其他编程语言类似</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">"你好，我今年%s岁"</span> 18</span><br><span class="line"><span class="built_in">printf</span> <span class="string">"我的名字叫：%-3s"</span> 熊小帅</span><br><span class="line"><span class="built_in">printf</span> <span class="string">"我的体重是：%-4.2fkg"</span> 70.5</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜ sh test.sh</span><br><span class="line">你好，我今年18岁</span><br><span class="line">我的名字叫：熊小帅</span><br><span class="line">我的体重是：70.50kg</span><br></pre></td></tr></table></figure><blockquote><p><code>%-3s</code> -表示左对齐，3 表示显示3个字符，<code>%-4.2f</code> .2表示保留两位小数</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这是用来记录学习shell的文章。&lt;/p&gt;
    
    </summary>
    
      <category term="Shell" scheme="https://blog.mokeee.com/categories/Shell/"/>
    
    
  </entry>
  
  <entry>
    <title>使用Redis锁来处理并发</title>
    <link href="https://blog.mokeee.com/2019/07/10/redis-lock/"/>
    <id>https://blog.mokeee.com/2019/07/10/redis-lock/</id>
    <published>2019-07-10T15:05:49.000Z</published>
    <updated>2020-01-06T12:06:27.209Z</updated>
    
    <content type="html"><![CDATA[<p>Redis</p><a id="more"></a><p><strong>问题：</strong></p><p>最近在和第三方对接支付，今天看日志发现他们的回调竟然并发了，有点方。<br>虽然每次回调的时候，都会查数据库检查这个订单的状态，然后对进行相应处理。但同一个订单如果遇到并发，第一个请求还没写入数据库，第二个请求就来了，这种情况就会导致错误。</p><p><img src="http://images.mokeee.com/blog/20190710230813.png" alt=""></p><p><strong>解决办法：</strong></p><p>使用Redis锁，每个请求到达时先加锁，如果加锁成功才会执行后面的业务逻辑，执行结束后释放锁。</p><p>比如：同一个订单并发的情况，我们可以使用订单号作为Redis的键名，每次请求前都会先加锁，如果加锁失败，说明该订单正在进行处理，并把这个请求挡回去；如果加锁成功，则执行后面的业务逻辑，并在完成后解锁。</p><p>我想到的是使用Redis的set命令，2.6.12之后版本，Redis set指令支持了nx、ex模式，并支持原子化地设置过期时间。</p><blockquote><p>NX ：只在键不存在时，才对键进行设置操作。 SET key value NX 效果等同于 SETNX key value 。</p></blockquote><p><img src="http://images.mokeee.com/blog/20190710232324.png" alt=""></p><p><strong>PHP实现</strong></p><ol><li>加锁<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 加锁</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $orderId 订单ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool|int 加锁成功返回唯一锁ID，加锁失败返回false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">addLock</span><span class="params">($orderId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!$orderId)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $key = <span class="keyword">self</span>::REDIS_LOCK_NAME . $orderId;</span><br><span class="line">    $client = BaseRedis::getClient();</span><br><span class="line">    <span class="comment">//生成锁ID 自行实现</span></span><br><span class="line">    $lockId = uniqid();</span><br><span class="line">    <span class="comment">//需要设置一个到期时间，避免死锁</span></span><br><span class="line">    $res = $client-&gt;set($key, $lockId, [<span class="string">'nx'</span>, <span class="string">'ex'</span> =&gt; <span class="keyword">self</span>::REDIS_LOCK_EXPIRE_TIME]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $res ? $lockId : $res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>2.解锁</p><p>解锁时用lockId进行比较，如果相等则删除锁。</p><blockquote><p>watch: 监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解锁</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $orderId 订单ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $lockId 锁唯一ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">unLock</span><span class="params">($orderId, $lockId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!$orderId)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $key = <span class="keyword">self</span>::REDIS_LOCK_NAME . $orderId;</span><br><span class="line">    $client = BaseRedis::getClient();</span><br><span class="line"></span><br><span class="line">    $client-&gt;watch($key);</span><br><span class="line">    <span class="keyword">if</span> ($lockId == $client-&gt;get($key)) &#123;</span><br><span class="line">        <span class="comment">// 以 MULTI 开始一个事务，然后将多个命令入队到事务中， 最后由 EXEC 命令触发事务，一并执行事务中的所有命令</span></span><br><span class="line">        $client-&gt;multi()-&gt;del($key)-&gt;exec();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $client-&gt;unwatch();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>目前对分布式缓存还不太了解，后续学习。</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Redis&lt;/p&gt;
    
    </summary>
    
      <category term="Redis" scheme="https://blog.mokeee.com/categories/Redis/"/>
    
    
      <category term="并发" scheme="https://blog.mokeee.com/tags/%E5%B9%B6%E5%8F%91/"/>
    
      <category term="Redis" scheme="https://blog.mokeee.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>使用OpenSSL进行RSA签名和加密解密</title>
    <link href="https://blog.mokeee.com/2019/07/09/open-ssl-rsa-sign-encrypt/"/>
    <id>https://blog.mokeee.com/2019/07/09/open-ssl-rsa-sign-encrypt/</id>
    <published>2019-07-09T03:56:32.000Z</published>
    <updated>2019-07-10T15:28:24.146Z</updated>
    
    <content type="html"><![CDATA[<p>PHP7之后，mcrypt扩展就已经被弃用，我们可以使用OpenSSL拓展来代替。</p><a id="more"></a><p><img src="http://images.mokeee.com/blog/20190710151011.png" alt=""></p><p><strong>RSA加密算法是一种非对称加密算法，用法总结起来就是：公钥加密、私钥解密、私钥签名、公钥验签。</strong></p><p>签名与加密的作用：<br>1.签名是为了防止数据被篡改<br>2.加密是为了防止数据被泄露</p><h3 id="格式化公钥私钥"><a href="#格式化公钥私钥" class="headerlink" title="格式化公钥私钥"></a>格式化公钥私钥</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 格式化私钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $privateKey</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">getPrivateKey</span><span class="params">($privateKey)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $key = chunk_split($privateKey,<span class="number">64</span>,<span class="string">"\n"</span>);</span><br><span class="line">        $key = <span class="string">"-----BEGIN PRIVATE KEY-----\n"</span> . $key . <span class="string">"-----END PRIVATE KEY-----\n"</span>;</span><br><span class="line">        <span class="keyword">return</span> $key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 格式化公钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $privateKey</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">getPublicKey</span><span class="params">($publicKey)</span></span>&#123;</span><br><span class="line">        $key = chunk_split($publicKey,<span class="number">64</span>,<span class="string">"\n"</span>);</span><br><span class="line">        $key = <span class="string">"-----BEGIN PUBLIC KEY-----\n"</span> . $key . <span class="string">"-----END PUBLIC KEY-----\n"</span>;</span><br><span class="line">        <span class="keyword">return</span> $key;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="使用私钥签名"><a href="#使用私钥签名" class="headerlink" title="使用私钥签名"></a>使用私钥签名</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 签名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $privateKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">sign</span><span class="params">($data, $privateKey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $signature = <span class="string">''</span>;</span><br><span class="line">    openssl_sign($str, $signature, $privateKey, OPENSSL_ALGO_SHA1);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> base64_encode($signature);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用公钥验签"><a href="#使用公钥验签" class="headerlink" title="使用公钥验签"></a>使用公钥验签</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验签</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $return</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $sign</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $publicKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify</span><span class="params">($params, $sign, $publicKey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $verify = openssl_verify($params, base64_decode($sign), $publicKey);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($verify != <span class="number">1</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用公钥加密"><a href="#使用公钥加密" class="headerlink" title="使用公钥加密"></a>使用公钥加密</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * rsa 公钥加密</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $data string 待加密的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $public_key 公钥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rsaPublicEncrypt</span><span class="params">($data, $publicKey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $key = openssl_pkey_get_public($publicKey);</span><br><span class="line">    $encrypted = <span class="string">''</span>;</span><br><span class="line">    openssl_public_encrypt($data, $encrypted, $key);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> base64_encode($encrypted);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用私钥解密"><a href="#使用私钥解密" class="headerlink" title="使用私钥解密"></a>使用私钥解密</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 私钥解密</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $encrypted 被加密的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $private_key 私钥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rsaPrivateDecrypt</span><span class="params">($encrypted, $private_key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    openssl_private_decrypt(base64_decode($encrypted),$decrypted,$private_key);</span><br><span class="line">    <span class="keyword">return</span> $decrypted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;PHP7之后，mcrypt扩展就已经被弃用，我们可以使用OpenSSL拓展来代替。&lt;/p&gt;
    
    </summary>
    
      <category term="PHP" scheme="https://blog.mokeee.com/categories/PHP/"/>
    
    
      <category term="openSSL" scheme="https://blog.mokeee.com/tags/openSSL/"/>
    
      <category term="RSA" scheme="https://blog.mokeee.com/tags/RSA/"/>
    
  </entry>
  
  <entry>
    <title>Mac上使用Homebrew搭建LNMP环境（简要版）</title>
    <link href="https://blog.mokeee.com/2019/06/09/mac-homebrew-lnmp/"/>
    <id>https://blog.mokeee.com/2019/06/09/mac-homebrew-lnmp/</id>
    <published>2019-06-09T09:18:39.000Z</published>
    <updated>2019-06-09T14:19:23.084Z</updated>
    
    <content type="html"><![CDATA[<p>最近发现自己这台Mac充电口已经糊掉了，并且使用的时候发热严重，于是向公司申请了一台。</p><a id="more"></a><p><img src="http://images.mokeee.com/blog/IMG_2250.JPG" alt=""></p><p><img src="http://images.mokeee.com/blog/UNADJUSTEDNONRAW_thumb_14b9.jpg" alt=""></p><p>结果给了我一台13寸的，而且键盘磨得漆都掉了。🤣</p><p>拿到手第一件事情就是咔咔重装系统，然后开始装开发环境。</p><h2 id="一、安装Homebrew"><a href="#一、安装Homebrew" class="headerlink" title="一、安装Homebrew"></a>一、安装Homebrew</h2><h3 id="1-安装comman-line"><a href="#1-安装comman-line" class="headerlink" title="1.安装comman line"></a>1.安装comman line</h3><blockquote><p><a href="https://brew.sh/">Homebrew</a> 是一个包管理器，用于在Mac上安装一些OS X没有的UNIX工具</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure><p>如果提示失败，请尝试手动安装<br>到这个地址 <a href="https://developer.apple.com/download/more/">https://developer.apple.com/download/more/</a> 下载Command Line Tools，选择适合自己的版本。</p><p><img src="http://images.mokeee.com/blog/xcode_command_line.jpg" alt=""></p><h3 id="2-安装Homebrew"><a href="#2-安装Homebrew" class="headerlink" title="2.安装Homebrew"></a>2.安装Homebrew</h3><p>运行下面的命令即可安装Homebrew，安装开始前会有提示，同意即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br></pre></td></tr></table></figure><h2 id="二、安装Nginx"><a href="#二、安装Nginx" class="headerlink" title="二、安装Nginx"></a>二、安装Nginx</h2><p>运行下面的命令来安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nginx</span><br></pre></td></tr></table></figure><p>安装完成后将Nginx加入开机自启</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/<span class="built_in">local</span>/opt/nginx/homebrew.mxcl.nginx.plist ~/Library/LaunchAgents/</span><br><span class="line">launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</span><br></pre></td></tr></table></figure><p>给Nginx root权限 (路径根据版本而定)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown root:wheel /usr/<span class="built_in">local</span>/Cellar/nginx/1.6.0_1/bin/nginx</span><br><span class="line">sudo chmod u+s /usr/<span class="built_in">local</span>/Cellar/nginx/1.6.0_1/bin/nginx</span><br></pre></td></tr></table></figure><p>如果nginx启动报错：<code>nginx: [error] open() &quot;/usr/local/var/run/nginx.pid&quot; failed (2: No such file or directory)</code></p><p>执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -c /usr/<span class="built_in">local</span>/etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><h2 id="三、安装MySql"><a href="#三、安装MySql" class="headerlink" title="三、安装MySql"></a>三、安装MySql</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install mysql@5.7</span><br></pre></td></tr></table></figure><p>安装完成后开启mysql：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/opt/mysql@5.7/bin/mysql.server start</span><br></pre></td></tr></table></figure><p>然后设置密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/opt/mysql@5.7/bin/mysql_secure_installation</span><br></pre></td></tr></table></figure><p>根据提示操作即可</p><p>将MySql加入开机自启（路径根据版本而定）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/<span class="built_in">local</span>/opt/mysql@5.7/homebrew.mxcl.mysql@5.7.plist  ~/Library/LaunchAgents/</span><br><span class="line">launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.mysql@5.7.plist</span><br></pre></td></tr></table></figure><h2 id="四、安装PHP"><a href="#四、安装PHP" class="headerlink" title="四、安装PHP"></a>四、安装PHP</h2><h3 id="1-安装PHP"><a href="#1-安装PHP" class="headerlink" title="1.安装PHP"></a>1.安装PHP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install php@7.1</span><br></pre></td></tr></table></figure><p>将php加入环境变量，运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH="/usr/local/opt/php@7.1/bin:$PATH"'</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH="/usr/local/opt/php@7.1/sbin:$PATH"'</span> &gt;&gt; ~/.bash_profile</span><br></pre></td></tr></table></figure><p>关闭终端，重新打开</p><h3 id="2-安装PHP扩展"><a href="#2-安装PHP扩展" class="headerlink" title="2.安装PHP扩展"></a>2.安装PHP扩展</h3><p>我们可以使用<code>pecl</code>命令来安装PHP拓展，如果你安装的PHP版本&gt;=7.1，pecl也一同安装好了。</p><blockquote><p>使用pecl安装拓展，只需执行命令即可，其他的会给你自动配置好，是不是敲方便的！</p></blockquote><p>安装Yaf扩展：<code>pecl install yaf</code><br>安装redis扩展： <code>pecl install install</code><br>安装debug：<code>pecl install xdebug</code>  </p><p>扩展安装完成后记得重启php-fpm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services restart php@7.1</span><br></pre></td></tr></table></figure><h2 id="五、安装redis"><a href="#五、安装redis" class="headerlink" title="五、安装redis"></a>五、安装redis</h2><p>同理，运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install redis</span><br></pre></td></tr></table></figure><h2 id="六、命令"><a href="#六、命令" class="headerlink" title="六、命令"></a>六、命令</h2><p>可能会用到的一些命令： </p><h3 id="1-搜索"><a href="#1-搜索" class="headerlink" title="1. 搜索"></a>1. 搜索</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew search php</span><br></pre></td></tr></table></figure><p><img src="http://images.mokeee.com/blog/brew_search.jpg" alt=""></p><h3 id="2-安装卸载"><a href="#2-安装卸载" class="headerlink" title="2.安装卸载"></a>2.安装卸载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install\uninstall php@7.1</span><br></pre></td></tr></table></figure><h3 id="3-启动-重启-停止服务："><a href="#3-启动-重启-停止服务：" class="headerlink" title="3.启动\重启\停止服务："></a>3.启动\重启\停止服务：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services start\restart\stop nginx\mysql@5.7\php@7.1</span><br></pre></td></tr></table></figure><h3 id="4-查看某个包的信息："><a href="#4-查看某个包的信息：" class="headerlink" title="4.查看某个包的信息："></a>4.查看某个包的信息：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew info nginx</span><br></pre></td></tr></table></figure><p>该命令会显示安装路径、配置文件等信息</p><p><img src="http://images.mokeee.com/blog/brew_info.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近发现自己这台Mac充电口已经糊掉了，并且使用的时候发热严重，于是向公司申请了一台。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Homebrew" scheme="https://blog.mokeee.com/tags/Homebrew/"/>
    
      <category term="LNMP" scheme="https://blog.mokeee.com/tags/LNMP/"/>
    
  </entry>
  
  <entry>
    <title>记一次使用PHP将word转为excel的经历</title>
    <link href="https://blog.mokeee.com/2019/01/12/word-to-excel-use-php/"/>
    <id>https://blog.mokeee.com/2019/01/12/word-to-excel-use-php/</id>
    <published>2019-01-12T08:24:06.000Z</published>
    <updated>2019-06-09T09:18:02.850Z</updated>
    
    <content type="html"><![CDATA[<p>昨天一位朋友找到我，说他手上有几千个word表格需要转换到一个excel文件里，他在网上也没有找到满足需求的软件，于是让我帮忙用程序实现。</p><a id="more"></a><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>需求如下图所示：每个文档文档中有一个或多个格式固定的表格，需要把每一个word表格转换为excel文件里的一行。</p><p>from:</p><p><img src="http://images.mokeee.com/2019-01-12-IMG_6264-20190112-024237-.jpg?imageView2/3/w/1000/h/1000/interlace/1/q/100" alt="IMG_6264-20190112-024237-"></p><p>to:</p><p><img src="http://images.mokeee.com/2019-01-12-IMG_6265-20190112-024237-.jpg?imageView2/3/w/1000/h/1000/interlace/1/q/100" alt="IMG_6265-20190112-024237-"></p><h3 id="寻找解决方案"><a href="#寻找解决方案" class="headerlink" title="寻找解决方案"></a>寻找解决方案</h3><p>我首先想到的是用PHP读取word文档，处理之后转成excel。</p><p>转成excel比较简单，使用PHP系统函数<code>fputcsv</code>就可以搞定，现在需要做的是读取到word文档里的内容。</p><p>紧接着我便去网上查找，看有没有PHP的扩展能够读取word文档。<br>在Github搜索到一个叫做 <a href="https://github.com/PHPOffice/PHPWord">PHPWord</a> 的扩展，不过遗憾的是，这个扩展只能往word文档里写入内容，并不能读取。</p><p>我又想，能不能把word转成其他格式再读取。<br>于是我将word文档的后缀改成了<code>txt</code>,打开文件后内容如下图。</p><p>密密麻麻的一大堆，反正我是没能从中找到什么规律，于是放弃了这种方法。</p><p><img src="http://images.mokeee.com/2019-01-12-15472784366824.jpg?imageView2/3/w/1000/h/1000/interlace/1/q/100" alt="-w973"></p><p>接着我在word的另存为功能中，发现可以另存为其他格式。</p><p><img src="http://images.mokeee.com/2019-01-12-15472786250739.jpg?imageView2/3/w/1000/h/1000/interlace/1/q/100" alt="-w322"></p><p>于是选择保存为<code>htm</code>文件，随后在浏览器中打开转换好的文件，发现表格转换成了html中的table表格，非常标准。</p><p><img src="http://images.mokeee.com/2019-01-12-15472790353553.jpg?imageView2/3/w/1000/h/1000/interlace/1/q/100" alt="-w540"></p><p>这样我只需要遍历读取htm文件，获取其中的内容，再进行相应处理便能得到最终数据。</p><h3 id="进行处理"><a href="#进行处理" class="headerlink" title="进行处理"></a>进行处理</h3><h5 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h5><p> 首先我在网上下载了软件，将word文档批量转换为htm文件，并放在同一目录下</p><h5 id="读取文件内容"><a href="#读取文件内容" class="headerlink" title="读取文件内容"></a>读取文件内容</h5><p>我们事先将所有转换好的文件放在了同一目录下，所以只需要遍历该目录，并使用<code>file_get_contents()</code>函数就能获取到每个文件的内容。</p><h5 id="提取有用内容"><a href="#提取有用内容" class="headerlink" title="提取有用内容"></a>提取有用内容</h5><p>查看htm源代码能发现，每个word表格转换后变成了一个html表格，只需要先取到<code>&lt;table&gt;&lt;/table&gt;</code>标签里的内容，然后再按行分割，按列分割，便能得到我们想要的数据了。</p><p>附上简略代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生成csv文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">writeExcel</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//写入文档头部</span></span><br><span class="line">    $fileName = <span class="string">'./data.csv'</span>;</span><br><span class="line">    file_put_contents($fileName,<span class="string">''</span>);</span><br><span class="line">    $handle = fopen($fileName, <span class="string">'w'</span>);</span><br><span class="line">    fwrite($handle, chr(<span class="number">0xEF</span>).chr(<span class="number">0xBB</span>).chr(<span class="number">0xBF</span>)); <span class="comment">// 写入BOM头，防止乱码</span></span><br><span class="line">    $titleArr = [<span class="string">'A'</span>  =&gt; <span class="string">'样品类型'</span>, <span class="string">'B'</span>  =&gt; <span class="string">'图幅编号'</span>];<span class="comment">//次数省略</span></span><br><span class="line">    fputcsv($handle, $titleArr);</span><br><span class="line">    <span class="keyword">return</span> $handle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取文件夹下的所有文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scanFile</span><span class="params">($path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $result = [];</span><br><span class="line">    $files = scandir($path);</span><br><span class="line">    <span class="keyword">foreach</span> ($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($file != <span class="string">'.'</span> &amp;&amp; $file != <span class="string">'..'</span>) &#123;</span><br><span class="line">            $result[] = basename($file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//提取表格内容</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getContents</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $filesArr = scanFile(<span class="string">'./'</span>);</span><br><span class="line">    $handle = writeExcelHeader();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span> ($filesName <span class="keyword">as</span> $k =&gt; $v)&#123;</span><br><span class="line">        <span class="comment">//读取文件内容</span></span><br><span class="line">        $text = file_get_contents($path . $v);</span><br><span class="line">        <span class="comment">//转换编码</span></span><br><span class="line">        $text = iconv(<span class="string">"gb2312"</span>, <span class="string">"utf-8//IGNORE"</span>,$text);</span><br><span class="line">        <span class="comment">//去除html标签多余属性</span></span><br><span class="line">        $text = preg_replace(<span class="string">"/&lt;([a-zA-Z]+)[^&gt;]*&gt;/"</span>,<span class="string">"&lt;\\1&gt;"</span>,$text);</span><br><span class="line">        <span class="comment">//提取表格内容</span></span><br><span class="line">        preg_match_all(<span class="string">"/&lt;table&gt;(.*?)&lt;\/table&gt;/is"</span>,$text,$matches);</span><br><span class="line">        <span class="comment">//处理表格内容</span></span><br><span class="line">        <span class="keyword">foreach</span> ($matches[<span class="number">1</span>] <span class="keyword">as</span> $match)&#123;</span><br><span class="line">            html2excel($match, $handle);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理表格内容</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convert</span><span class="params">($content)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $res = [];</span><br><span class="line">    <span class="comment">//按行拆分</span></span><br><span class="line">    $trArr = explode(<span class="string">'&lt;tr&gt;'</span>, $content);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span> ($trArr <span class="keyword">as</span> $k =&gt; $tr)&#123;</span><br><span class="line">        <span class="comment">//去除多余标签</span></span><br><span class="line">        $tr = str_replace(<span class="string">'&lt;/tr&gt;'</span>,<span class="string">''</span>, $tr);</span><br><span class="line">        <span class="comment">//按列拆分</span></span><br><span class="line">        $tdArr = explode(<span class="string">'&lt;td&gt;'</span>, $tr);</span><br><span class="line">        <span class="keyword">foreach</span> ($tdArr <span class="keyword">as</span> $kk =&gt; $td)&#123;</span><br><span class="line">            <span class="comment">//去除多余标签</span></span><br><span class="line">            $td = str_replace(<span class="string">'&lt;/td&gt;'</span>,<span class="string">''</span>, $td);</span><br><span class="line">            <span class="comment">//去除html标签 得到内容</span></span><br><span class="line">            $text = strip_tags($td);</span><br><span class="line">            $res[] = $text;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fputcsv($handel, $res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getContents();</span><br></pre></td></tr></table></figure><h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>使用到的一些函数：</p><ol><li><code>iconv()</code> 编码转换</li><li><code>preg_replace()</code> 使用正则替换文本</li><li><code>preg_match_all()</code> 使用正则获取内容</li><li><code>strip_tags()</code> 去除文本中的html标签</li><li><code>str_replace()</code> 文本替换</li><li><code>fputcsv()</code> 将制定内容写入csv文件</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;昨天一位朋友找到我，说他手上有几千个word表格需要转换到一个excel文件里，他在网上也没有找到满足需求的软件，于是让我帮忙用程序实现。&lt;/p&gt;
    
    </summary>
    
      <category term="PHP" scheme="https://blog.mokeee.com/categories/PHP/"/>
    
    
      <category term="Safari" scheme="https://blog.mokeee.com/tags/Safari/"/>
    
  </entry>
  
  <entry>
    <title>Safari【阻止跨网站追踪】遇到的问题</title>
    <link href="https://blog.mokeee.com/2019/01/06/safari-cookie/"/>
    <id>https://blog.mokeee.com/2019/01/06/safari-cookie/</id>
    <published>2019-01-06T07:30:59.000Z</published>
    <updated>2020-01-06T12:06:51.624Z</updated>
    
    <content type="html"><![CDATA[<p>Safari Cookie</p><a id="more"></a><h3 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h3><p>现有AB两个域名，分别使用在AB网站上。</p><ol><li>A向B发送一个jsonp跨域请求，进行用户登录操作</li><li>B收到请求并验证通过后会在自己的域名下写一个包含当前用户信息的cookie</li><li>当A网站再次向B网站发起获取用户信息的请求时，B网站会读取自己域名下的这个cookie来获取当前用户的信息并返回给A</li></ol><h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><p>在Windows PC上测试时一切正常，没有任何问题。<br>当使用Safari浏览器访问A网站时，用户登录操作正常，但在登录成功后，向B网站发起获取用户信息的请求时，总是提示获取不到。</p><p>在一番查找资料后发现，iOS系统上的Safari设置中默认开启了 <strong>阻止跨网站追踪</strong> 的功能，从而导致A网站向B网站发请求，B网站写cookie在B域名下的操作也无法完成…</p><p><img src="http://images.mokeee.com/2019-01-06-15467592058885.jpg" alt=""></p><p>**这个问题会出现在所有使用AppleWebkit内核的浏览器中。</p><blockquote><p>由于iOS系统限制，苹果只允许第三方浏览器使用AppleWebkit内核，所以按理iOS上的所有浏览器都会出现这个问题。</p></blockquote><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>严格来说也不算解决办法，算曲线救国吧…</p><p>当A向B发起登录请求并收到返回的数据后，A网站前端将B返回的数据存在A的cookie中，并在以后每次请求B时将cookie中的信息以参数形式发送给B。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Safari Cookie&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
